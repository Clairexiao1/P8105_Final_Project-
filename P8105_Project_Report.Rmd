---
title: "Project Report"
output: 
  html_document:
    toc: TRUE
    toc_float: TRUE
    code_folding: hide
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  out.width = "90%")

library(tidyverse)
library(patchwork)
library(kableExtra)
library(ggplot2)
library(plotly)
library(gganimate)
library(gifski)
library(png)
library(leaflet)
library(rvest)
library(shiny)
library(RColorBrewer)

theme_set(theme_minimal() + theme(legend.position = "bottom"))
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

<style type="text/css">

h1.title {
  text-align: center;
}

</style>

## __Motivation__   

<br>Michelin stars are what every chef is looking for! Even the most renowned chefs will be worried about losing stars, and even cry after losing one or two stars. However, the majority of chefs are devoting their lives just for one star. It is obvious that Michelin stars are important for chefs, but the controversies around this guide always exist.    

&nbsp;  
  
### _Related Work_ 
      
1. "Are Michelin-starred Restaurants Predictable?"  [Link.](https://medium.com/@grantcho/are-michelin-starred-restaurants-predictable-8398c041f4ed)   

2. "Predicting Michelin Stars from Yelp Reviews in San Francisco"
[Link.](https://nycdatascience.com/blog/student-works/predicting-michelin-stars-yelp-reviews-san-francisco/)

&nbsp;   

## __Questions__ 

<br>In this project, we would like to explore the following questions:     

1. How are Michelin Restaurants distributed around the world, by continent, by country? 
2. How much does dining at Michelin Restaurants cost?
3. Whether certain cuisine types usually have higher ranking in Michelin Star?
4. Are certain cuisine associated with higher prices? In addition, do the prices varies by the continent?
5. What is the relationship between stars and prices? 

&nbsp;   

## __Data__   

&nbsp;   

### _Data Sources_   

 __1. [Michelin Restaurant Ratings Globally](https://www.kaggle.com/jackywang529/michelin-restaurants)__   

<br>Michelin Restaurant Ratings Globally is the main data source of our project, which contains three separate datasets for one-star Michelin restaurants, two-stars Michelin restaurants and three-stars Michelin restaurants. All these restaurants collected from 2018-2019 [Michelin Guide](https://guide.michelin.com/us/en). There are 695 restaurants in total with their information of restaurant name, released year, location data, cuisine type, price and official URLs. 
      
Variable | Description
------------- | -------------
`name` | restaurant name
`year`  | released year from Michelin Guide
`latitude`, `longitude`  | restaurant coordinates
`city`  | cities restaurants locate in
`region`  | regions restaurants locate in 
`zipCode`  | zip codes of restaurants
`cuisine`  | cuisine types of restaurants 
`price`  | 	restaurant price levels 
`url`  | 	restaurant official website links  

&nbsp;   
       
__2. [Starred Restaurants of Michelin Guide 2020](https://data.public.lu/en/datasets/michelin-restaurants-in-2020/)__     

<br>Starred Restaurants of Michelin Guide 2020 contains 2020 newly released one-star, two-stars and three-stars Michelin restaurants collected from 2020 [Michelin Guide](https://guide.michelin.com/us/en). There are 86 restaurants in total with their information of restaurant name, released year, location(i.e., latitude, longitude, city and region), star level and official URLs. Since this dataset does not contain enough data, such as price and cuisine, it was only a supplementary data source for mapping and geographic comparison. 
    
Variable | Description
------------- | -------------
`latitude`,`longitude`, `altitude`  | restaurant coordinates
`geometry` | point
`OBJECTID` | ID
`name` | restaurant name
`region`  | regions restaurants locate in 
`city`  | cities restaurants locate in
`stars`  | restaurant star levels 
`link`  | 	restaurant official website links 
`description`  | restaurants description

&nbsp;   

### _Data Cleaning_     
    
For general data cleaning, all three Michelin restaurants datasets were imported from [Michelin Restaurant Ratings Globally](https://www.kaggle.com/jackywang529/michelin-restaurants) in the format of csv. In each dataset, a new column `star` was added for indicating the star level of the restaurant. For example, in one-star Michelin restaurants dataset, `star` was set to `one` for all restaurants. The final 2018-2019 Michelin dataset was combined from one-star, two-stars and three-stars Michelin restaurant datasets by `rbind`. The variables were then renamed, recoded and selected based on if they were intuitive and if they were needed for analyses. For example, `region` was recoded to `country`, and new variable `continent` was created for later continental comparison analysis.  
      
```{r message=FALSE}
one_star <-
  read_csv("./data/one-star-michelin-restaurants.csv") %>%
  mutate(star = "one")

two_star <-
  read_csv("./data/two-stars-michelin-restaurants.csv") %>%
  mutate(star = "two")

three_star <-
  read_csv("./data/three-stars-michelin-restaurants.csv") %>%
  mutate(star = "three")

michelin_df <-
  rbind(one_star,two_star,three_star) %>%
  janitor::clean_names() %>%
  select(-zip_code, -url) %>%
  rename(country = region) %>%
  mutate(price = case_when(
    price == "$$$$$" ~ "5",
    price == "$$$$" ~ "4",
    price == "$$$" ~ "3",
    price == "$$" ~ "2",
    price == "$" ~ "1")) %>%
  mutate(country = case_when(
    country == "Austria" ~ "Austria",
    country == "California" ~ "USA",
    country == "Chicago" ~ "USA",
    country == "New York City" ~ "USA",
    country == "Washington DC" ~ "USA",
    country == "Croatia" ~ "Croatia",
    country == "Czech Republic" ~ "Czech Republic",
    country == "Denmark" ~ "Denmark",
    country == "Finland" ~ "Finland",
    country == "Hong Kong" ~ "China",
    country == "Macau" ~ "China",
    country == "Taipei" ~ "China",
    country == "Hungary" ~ "Hungary",
    country == "Norway" ~ "Norway",
    country == "Poland" ~ "Poland",
    country == "Ireland" ~ "Ireland",
    country == "Rio de Janeiro" ~ "Brazil",
    country == "Sao Paulo" ~ "Brazil",
    country == "South Korea" ~ "South Korea",
    country == "Sweden" ~ "Sweden",
    country == "Singapore" ~ "Singapore",
    country == "Thailand" ~ "Thailand",
    country == "United Kingdom" ~ "United Kingdom")) %>%
  mutate(country = ifelse(city == "AthÃ­na", "Greece", country)) %>%
  mutate(continent = case_when(
    country == "Austria" ~ "Europe",
    country == "USA" ~ "North America",
    country == "Croatia" ~ "Europe",
    country == "Czech Republic" ~ "Europe",
    country == "Denmark" ~ "Europe",
    country == "Finland" ~ "Europe",
    country == "China" ~ "Asia",
    country == "Hungary" ~ "Europe",
    country == "Norway" ~ "Europe",
    country == "Poland" ~ "Europe",
    country == "Ireland" ~ "Europe",
    country == "Brazil" ~ "South America",
    country == "South Korea" ~ "Asia",
    country == "Sweden" ~ "Europe",
    country == "Singapore" ~ "Asia",
    country == "Thailand" ~ "Asia",
    country == "United Kingdom" ~ "Europe",
    country == "Greece" ~ "Europe")) %>%
  relocate(name, year,city,country,continent)
```
    
#### Michelin Cuisine 
      
Cuisine types were recoded into 19 simplified categories according to country and continent, and a new column `cuisine_new` was added to the dataset. `star` was recoded into numeric numbers 1-3 for future analysis. Column `price` was added by converting number of dollar signs to price level. For example, one dollar sign `$` was recoded to 1 for `price`.   

```{r}
michelin_cuisine <-
  michelin_df %>% 
  mutate(
    cuisine_new = fct_collapse(cuisine,
                   American = c("American", "Californian"), 
                   Australian = c("Australian"),
                   Other_Asian = c("Asian", "Asian contemporary", "Asian influences", "Peranakan"),
                   Chinese = c("Cantonese", "Hang Zhou", "Sichuan", "Sichuan-Huai Yang", "Cantonese Roast Meats", "Fujian", "Hunanese and Sichuan", "Chinese", "Shanghainese", "Taiwanese", "Dim Sum", "Taizhou", "Noodles and congee"), 
                   French = c("Classic French", "French contemporary", "Creative French", "French", "Modern French"),
                   British = c("Creative British", "Traditional British", "Modern British"), 
                   Other_European = c("European", "European contemporary", "Austrian", "Danish", "Finnish"),
                   Meats = c("Meats and grills", "Barbecue"),
                   Modern = c("modern", "Contemporary", "creative", "Fusion", "Modern cuisine", "Creative", "Gastropub", "Innovative"), 
                   Other = c("International", "Street Food", "Temple cuisine", "Seafood", "Vegetarian", "Classic cuisine", "Market cuisine", "Regional cuisine", "Steakhouse", "Moroccan"), 
                   Japanese = c("Japanese contemporary", "Sushi", "Teppanyaki", "Japanese"),
                   Scandinavian = c("Scandinavian"),
                   Italian = c("Italian", "Italian contemporary"),
                   Korean = c("Korean", "Korean contemporary"), 
                   Mediterranean = c("Mediterranean", "Mediterranean cuisine"),
                   Thai = c("Thai", "Southern Thai", "Thai Contemporary"), 
                   Indian = c("Indian"), 
                   Spanish = c("Spanish"), 
                   Mexican = c("Mexican"))
  ) %>%
  mutate(star = recode(star, "one" = "1", "two" = "2", "three" = "3")) %>%
  mutate(
    star = as.numeric(star))
```

#### Mapping 
     
For mapping data, [Starred Restaurants of Michelin Guide 2020](https://data.public.lu/en/datasets/michelin-restaurants-in-2020/) was cleaned in a similar way and imported in the format of csv as well. Only `name`, `city`,`stars`,`latitude` and `longtitude` were selected from original dataset. To combine 2020 and 2018-2019 Michelin restaurants datasets, `stars` was renamed to `star`, `year` = 2000 and `continent` = Europe was added to 2020 Michelin restaurants dataset for consistency. The geographic distribution of Michelin restaurants was planned to be classified based on Michelin stars. Therefore, `star` was set to the factor variable and defined the order of values using `fct_relevel`. Finally, since the main parts of generating map are latitude and longitude data, any restaurants with `latitude` and `longitude` = NA were dropped. No additional world map data files were needed, and only `Leaflet`, an open-source JavaScript library, was utilized for creating interactive web maps. 

```{r,message=FALSE}
michelin_2020 <-
  read_csv("./data/michelin-restaurants-in-2020.csv") %>%
  janitor::clean_names() %>%
  select(-altitude,-geometry,-objectid,-region,-link,-description) %>%
  mutate(stars = case_when(
    stars == "3" ~ "three",
    stars == "2" ~ "two",
    stars == "1" ~ "one")) %>%
  rename(star = stars) %>%
  mutate(year = 2020) %>%
  mutate(continent = "Europe") %>%
  relocate(name,year,city,continent,latitude,longitude)

#write.csv(michelin_2020,"./data/michelin_2020.csv", row.names = FALSE)

michelin_map <-
  michelin_df %>%
  select(name, year, city, continent, latitude, longitude,star) %>%
  rbind(michelin_2020) %>%
  mutate(
    star = fct_relevel(star,"three","two","one")) 
```

&nbsp;   
     
## __Exploratory Analysis__   

<br>

### _Newly released Michelin restaurants global distribution (2018-2020)_

The following map shows the geographic distribution of Michelin restaurants released by Michelin Guide from 2018 to 2020, with information on restaurant name, which city the restaurant locates in and its star level included in the label. This map was used to determine the geographic spread of Michelin restaurants from 2018 to 2020 by restaurant star level, and shows that most of Michelin restaurants are still located in Europe, although the final dataset we had did not include countries which had the highest numbers of Michelin-starred restaurants, such as France, Japan and Italy.     

```{r}
star_color <-
  colorFactor("plasma",michelin_map %>% pull(star))

michelin_map %>%
  drop_na(longitude,latitude,city) %>%
  mutate(
    pop_info = str_c("Name: ", name,
                     "<br>City: ", city,
                     "<br>Star: ", star)) %>%
  leaflet() %>%
  addProviderTiles(providers$CartoDB.Positron) %>% 
  addLegend("bottomright", pal = star_color,
            values = ~ as.factor(star),
            title = "Michelin Star",
            labFormat = labelFormat(big.mark = ""),
            opacity = 1) %>%
  addCircleMarkers(~longitude, ~latitude,
                   color = ~star_color(star),
                   radius = 1,
                   popup = ~pop_info)
```

&nbsp;   
     
## __Additional Analysis__    

<br>

### _Michelin Cuisine Types and Stars_ 
Analysis on cuisine types and stars was done to examine the distribution of cuisine types along with information on each type's star rating. Further analysis on cuisine types and price was performed to look at price level by cuisine types. Lastly, the relationship between stars and price levels was investigated through graphing.

&nbsp;   

## __Discussion__ 

<br>

### _Limitations_ 
One limitation for interactive maps part is that the datasets we had for Michelin restaurants contained limited information, which prevented us from being able to include all Michelin restaurants released by Michelin Guide around the world into a more complete geographic distribution map. [Michelin Restaurant Ratings Globally](https://www.kaggle.com/jackywang529/michelin-restaurants) only contains restaurants info in following regions: Austria, California, Chicago, Croatia, Czech Republic, Denmark, Finland, Greece, Hong Kong, Hungary, Iceland, Macau, Norway, New York City, Poland, Ireland, Rio de Janeiro, Sao Paulo, South Korea, Singapore, Sweden, Taipei, Thailand, Washington DC, and United Kingdom. [Starred Restaurants of Michelin Guide 2020](https://data.public.lu/en/datasets/michelin-restaurants-in-2020/) contains restaurants info in some European countries, such as Germany, but the listing is still not complete. Therefore, after combining both two datasets, we still missed starred restaurants in Michelin popular countries, like Belgium, France, Italy and Japan. Although we tidied 2021 Michelin restaurants datasets by ourselves from Michelin Guide and Wikipedia, we still did not have the location information(i.e. longitude and latitude) of those Michelin restaurants. 

<br>Besides, the price information we have in the dataset is a categorical variable with 5 different price levels, which were indicated by `$` signs (i.e. `$`-`$$$$$`). We would loose a lot of information by treating it as a continuous variable and thus poses limitations to our analysis. 

&nbsp;   
     
### _Conclusions_